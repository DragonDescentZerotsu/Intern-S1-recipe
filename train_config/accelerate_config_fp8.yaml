compute_environment: LOCAL_MACHINE
distributed_type: FSDP
num_processes: 1          # 按节点 GPU 数改
mixed_precision: fp8

fsdp_config:
  fsdp_auto_wrap_policy: TRANSFORMER_BASED_WRAP
  fsdp_backward_prefetch: BACKWARD_PRE
  fsdp_state_dict_type: FULL_STATE_DICT
  use_orig_params: false

# FP8 专属配置（Accelerate 的 fp8_config；等效于用 FP8RecipeKwargs）
fp8_config:
  backend: TE             # TE = TransformerEngine
  fp8_format: HYBRID      # 训练推荐 HYBRID（fwd: e4m3, bwd: e5m2）
  amax_history_len: 1024
  amax_compute_algo: most_recent
  margin: 0
  interval: 1
  use_autocast_during_eval: false
